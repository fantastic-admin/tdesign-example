
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang-BOcZ4Qej.js";import{_ as te}from"./index.vue_vue_type_script_setup_true_lang-iPFP11Su.js";import{d as le,h as se,N as ne,P as ae,X as oe,n as D,am as F,a as re,I as K,Y as p,V as ue,Z as ie,bc as ce,bd as j,o as f,b as C,w as m,k as o,e as d,q as fe,aq as de,u as h,p as pe,be as V,ba as H,j as k,Q as M,A as q,L as J,J as A,E as ve,C as O,t as P}from"./index-GgsX_ArO.js";import me from"./index-Br3xbZ-r.js";import{_ as he}from"./item.vue_vue_type_script_setup_true_lang-DtgV2Sds.js";const xe={class:"h-12 flex flex-shrink-0 items-center"},be={class:"h-full w-14 flex-center"},_e=["onKeydown"],ye={key:0,class:"h-full w-14 flex-center border-s"},ge={class:"w-full flex justify-between px-4 py-3"},ke={class:"flex gap-8"},we={class:"inline-flex items-center gap-1 text-xs"},Re={class:"inline-flex items-center gap-1 text-xs"},Se={key:0,class:"inline-flex items-center gap-1 text-xs"},Ce=["data-index","onClick","onMouseover"],Ve={class:"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3"},Me={class:"truncate text-start text-base font-bold"},Te={key:1,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},ze={key:2,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},De=le({name:"Search",__name:"search",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(Q){const x=se(Q,"modelValue"),X=ne(),w=ae(),Y=oe(),u=D(""),T=D([]),a=D(-1),z=F("searchResultRef"),S=F("searchResultItemRef"),b=re(()=>{let n=[];return n=T.value.filter(e=>{let t=!1;return u.value!==""&&(e.title&&(typeof e.title=="function"?e.title().includes(u.value)&&(t=!0):e.title.includes(u.value)&&(t=!0)),e.path.includes(u.value)&&(t=!0),e.breadcrumb.some(r=>{var l;if(typeof r.title=="function"){if(r.title().includes(u.value))return!0}else if((l=r.title)!=null&&l.includes(u.value))return!0;return!1})&&(t=!0)),t}),n});K(()=>x.value,n=>{n?(u.value="",a.value=-1,p("up",I),p("down",E),p("enter",N),p("esc",e=>{w.settings.navSearch.enableHotkeys&&(e.preventDefault(),x.value=!1)})):(p.unbind("up",I),p.unbind("down",E),p.unbind("enter",N),p.unbind("esc"))}),K(()=>b.value,()=>{a.value=-1,$()}),ue(()=>{Z(),p("command+k, ctrl+k",n=>{w.settings.navSearch.enableHotkeys&&(n.preventDefault(),x.value=!0)})}),ie(()=>{p.unbind("command+k, ctrl+k")});function Z(){T.value=[],Y.allMenus.forEach(n=>{L(n.children)})}function G(n){var t;let e=!0;return(t=n.children)!=null&&t.every(r=>{var l;return((l=r.meta)==null?void 0:l.menu)===!1})&&(e=!1),e}function L(n,e,t,r){n.forEach(l=>{var s,i,c,v,_,y,R;if(((s=l.meta)==null?void 0:s.menu)!==!1){const g=ce(r)||[];l.children&&G(l)?(g.push({title:(i=l.meta)==null?void 0:i.title}),L(l.children,j(e,l.path),((c=l.meta)==null?void 0:c.icon)??t,g)):(g.push({title:(v=l.meta)==null?void 0:v.title}),T.value.push({path:j(e,l.path),icon:((_=l.meta)==null?void 0:_.icon)??t,title:(y=l.meta)==null?void 0:y.title,link:(R=l.meta)==null?void 0:R.link,breadcrumb:g}))}})}function I(){b.value.length&&(a.value-=1,a.value<0&&(a.value=b.value.length-1),$())}function E(){b.value.length&&(a.value+=1,a.value>b.value.length-1&&(a.value=0),$())}function N(){var n,e;a.value!==-1&&((e=(n=S.value)==null?void 0:n.find(t=>Number.parseInt(t.dataset.index)===a.value))==null||e.click())}function $(){var n,e,t,r,l,s,i,c;if((r=(t=(e=(n=z.value)==null?void 0:n.areaRef)==null?void 0:e.ref)==null?void 0:t.el)!=null&&r.viewportElement){const v=z.value.areaRef.ref.el.viewportElement;let _=0;if(a.value!==-1){_=v.scrollTop;const y=((s=(l=S.value)==null?void 0:l.find(B=>Number.parseInt(B.dataset.index)===a.value))==null?void 0:s.offsetTop)??0,R=((c=(i=S.value)==null?void 0:i.find(B=>Number.parseInt(B.dataset.index)===a.value))==null?void 0:c.clientHeight)??0,g=v.scrollTop,U=v.clientHeight;y+R>g+U?_=y+R-U:y<=g&&(_=y-16)}v.scrollTo({top:_})}}function W(n,e){e?window.open(e,"_blank"):X.push(n),x.value=!1}return(n,e)=>{const t=ve,r=te,l=ee;return f(),C(l,{ref_key:"searchResultRef",ref:z,modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=s=>x.value=s),border:"",footer:h(w).mode==="pc",closable:!1,class:"w-full lg-max-w-2xl","content-class":"flex flex-col p-0 min-h-auto","header-class":"p-0","footer-class":"p-0"},{header:m(()=>[o("div",xe,[o("div",be,[d(t,{name:"i-ri:search-line",size:18,class:"text-foreground/30"})]),fe(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>pe(u)?u.value=s:null),placeholder:"搜索页面，支持标题、URL模糊查询",class:"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30",onKeydown:[e[1]||(e[1]=V(s=>x.value=!1,["esc"])),V(H(I,["prevent"]),["up"]),V(H(E,["prevent"]),["down"]),V(H(N,["prevent"]),["enter"])]},null,40,_e),[[de,h(u)]]),h(w).mode==="mobile"?(f(),k("div",ye,[d(t,{name:"i-carbon:close",size:18,onClick:e[2]||(e[2]=s=>x.value=!1)})])):M("",!0)])]),footer:m(()=>[o("div",ge,[o("div",ke,[o("div",we,[d(r,null,{default:m(()=>[d(t,{name:"i-ion:md-return-left",size:14})]),_:1}),e[4]||(e[4]=o("span",null,"访问",-1))]),o("div",Re,[d(r,null,{default:m(()=>[d(t,{name:"i-ant-design:caret-up-filled",size:14})]),_:1}),d(r,null,{default:m(()=>[d(t,{name:"i-ant-design:caret-down-filled",size:14})]),_:1}),e[5]||(e[5]=o("span",null,"切换",-1))])]),h(w).settings.navSearch.enableHotkeys?(f(),k("div",Se,[d(r,null,{default:m(()=>e[6]||(e[6]=[q(" ESC ")])),_:1}),e[7]||(e[7]=o("span",null,"退出",-1))])):M("",!0)])]),default:m(()=>[o("div",null,[h(b).length>0?(f(!0),k(A,{key:0},J(h(b),(s,i)=>(f(),k("div",{ref_for:!0,ref_key:"searchResultItemRef",ref:S,key:s.path,class:"p-4","data-index":i,onClick:c=>W(s.path,s.link),onMouseover:c=>a.value=i},[o("a",{class:O(["flex cursor-pointer items-center border rounded-lg",{"-mt-4":i!==0,"bg-accent":i===h(a)}])},[s.icon?(f(),C(t,{key:0,name:s.icon,size:20,class:O(["basis-16 transition",{"scale-120 text-primary":i===h(a)}])},null,8,["name","class"])):M("",!0),o("div",Ve,[o("div",Me,P((typeof s.title=="function"?s.title():s.title)??"[ 无标题 ]"),1),s.breadcrumb.length?(f(),C(me,{key:0,class:"truncate"},{default:m(()=>[(f(!0),k(A,null,J(s.breadcrumb,(c,v)=>(f(),C(he,{key:v,class:"text-xs"},{default:m(()=>[q(P((typeof c.title=="function"?c.title():c.title)??"[ 无标题 ]"),1)]),_:2},1024))),128))]),_:2},1024)):M("",!0)])],2)],40,Ce))),128)):h(u)===""?(f(),k("div",Te,[d(t,{name:"i-tabler:mood-smile",size:40}),e[8]||(e[8]=o("p",{class:"m-2 text-base"}," 输入你要搜索的导航 ",-1))])):(f(),k("div",ze,[d(t,{name:"i-tabler:mood-empty",size:40}),e[9]||(e[9]=o("p",{class:"m-2 text-base"}," 没有找到你想要的 ",-1))]))])]),_:1},8,["modelValue","footer"])}}});export{De as _};
